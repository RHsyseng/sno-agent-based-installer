---
apiVersion: v1alpha1
kind: AgentConfig
metadata:
  name: {{ cluster.name }}
rendezvousIP: {{ host.ip }}
{% if cluster.ntps is defined -%}
additionalNTPSources:
{% for ntp in cluster.ntps -%}
- {{ ntp }}
{% endfor -%}
{% endif -%}
hosts:
  - hostname: {{ host.hostname }}
    interfaces:
      - name: {{ host.interface }}
        macAddress: {{ host.mac }}
    rootDeviceHints:
      deviceName: {{ host.disk }}
    networkConfig:
      {% if host.vlan.enabled -%}
      interfaces:
        - name: {{ host.vlan.name }}
          type: vlan
          state: up
          vlan:
            base-iface: {{ host.interface }}
            id: {{ host.vlan.id }}
          ipv4:
            enabled: true
            address:
              - ip: {{ host.ip }}
                prefix-length: {{ host.prefix }}
            dhcp: false
          ipv6:
            enabled: false
      dns-resolver:
        config:
          server:
            - {{ host.dns }}
      routes:
        config:
          - destination: 0.0.0.0/0
            next-hop-address: {{ host.gateway }}
            next-hop-interface: {{ host.vlan.name }}
            table-id: 254
      {% else %}
      interfaces:
        - name: {{ host.interface }}
          type: ethernet
          state: up
          mac-address: {{ host.mac }}
          ipv4:
            enabled: true
            address:
              - ip: {{ host.ip }}
                prefix-length: {{ host.prefix }}
            dhcp: false
          ipv6:
            enabled: false
      dns-resolver:
        config:
          server:
            - {{ host.dns }}
      routes:
        config:
          - destination: 0.0.0.0/0
            next-hop-address: {{ host.gateway }}
            next-hop-interface: {{ host.interface }}
            table-id: 254

      {% endif -%}

